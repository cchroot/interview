<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>优化总结 | 小墨鱼的面试笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/interview/egg.png">
    <meta name="description" content="小墨鱼的面试笔记">
    
    <link rel="preload" href="/interview/assets/css/0.styles.41202823.css" as="style"><link rel="preload" href="/interview/assets/js/app.315fcd90.js" as="script"><link rel="preload" href="/interview/assets/js/3.2951d97b.js" as="script"><link rel="preload" href="/interview/assets/js/40.20696ba5.js" as="script"><link rel="prefetch" href="/interview/assets/js/10.7ffca870.js"><link rel="prefetch" href="/interview/assets/js/11.a796a1e1.js"><link rel="prefetch" href="/interview/assets/js/12.c1a92f5b.js"><link rel="prefetch" href="/interview/assets/js/13.e23fb603.js"><link rel="prefetch" href="/interview/assets/js/14.6fe10376.js"><link rel="prefetch" href="/interview/assets/js/15.39fcb4a0.js"><link rel="prefetch" href="/interview/assets/js/16.a28d5ced.js"><link rel="prefetch" href="/interview/assets/js/17.a2ae2507.js"><link rel="prefetch" href="/interview/assets/js/18.f4d5c0b7.js"><link rel="prefetch" href="/interview/assets/js/19.9675a5ad.js"><link rel="prefetch" href="/interview/assets/js/2.51e9aef8.js"><link rel="prefetch" href="/interview/assets/js/20.eff5de6d.js"><link rel="prefetch" href="/interview/assets/js/21.39b07448.js"><link rel="prefetch" href="/interview/assets/js/22.2526b024.js"><link rel="prefetch" href="/interview/assets/js/23.e582a7d7.js"><link rel="prefetch" href="/interview/assets/js/24.6fab991d.js"><link rel="prefetch" href="/interview/assets/js/25.a11720bf.js"><link rel="prefetch" href="/interview/assets/js/26.ad35af4b.js"><link rel="prefetch" href="/interview/assets/js/27.a807c0ff.js"><link rel="prefetch" href="/interview/assets/js/28.43ec09a9.js"><link rel="prefetch" href="/interview/assets/js/29.40a4c8d6.js"><link rel="prefetch" href="/interview/assets/js/30.80f06240.js"><link rel="prefetch" href="/interview/assets/js/31.e254c535.js"><link rel="prefetch" href="/interview/assets/js/32.becfed3a.js"><link rel="prefetch" href="/interview/assets/js/33.169d624d.js"><link rel="prefetch" href="/interview/assets/js/34.e75ce0f2.js"><link rel="prefetch" href="/interview/assets/js/35.cfd2a91d.js"><link rel="prefetch" href="/interview/assets/js/36.813fc716.js"><link rel="prefetch" href="/interview/assets/js/37.1834af1c.js"><link rel="prefetch" href="/interview/assets/js/38.b3a019c6.js"><link rel="prefetch" href="/interview/assets/js/39.c64b6de1.js"><link rel="prefetch" href="/interview/assets/js/4.4edc6fe1.js"><link rel="prefetch" href="/interview/assets/js/41.364a730f.js"><link rel="prefetch" href="/interview/assets/js/42.ee2aef05.js"><link rel="prefetch" href="/interview/assets/js/43.752ba15f.js"><link rel="prefetch" href="/interview/assets/js/44.667525a3.js"><link rel="prefetch" href="/interview/assets/js/45.b2834a73.js"><link rel="prefetch" href="/interview/assets/js/46.f874b150.js"><link rel="prefetch" href="/interview/assets/js/47.b7dd2d1e.js"><link rel="prefetch" href="/interview/assets/js/48.0b79ef3e.js"><link rel="prefetch" href="/interview/assets/js/49.bb77babc.js"><link rel="prefetch" href="/interview/assets/js/5.5f1bafd5.js"><link rel="prefetch" href="/interview/assets/js/50.66c1fd87.js"><link rel="prefetch" href="/interview/assets/js/51.15241f09.js"><link rel="prefetch" href="/interview/assets/js/52.0d2383ca.js"><link rel="prefetch" href="/interview/assets/js/53.439b2bec.js"><link rel="prefetch" href="/interview/assets/js/6.8b1e859e.js"><link rel="prefetch" href="/interview/assets/js/7.2e1d4b27.js"><link rel="prefetch" href="/interview/assets/js/8.06e19e8e.js"><link rel="prefetch" href="/interview/assets/js/9.98b67c20.js">
    <link rel="stylesheet" href="/interview/assets/css/0.styles.41202823.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/interview/" class="home-link router-link-active"><img src="/interview/egg.png" alt="小墨鱼的面试笔记" class="logo"> <span class="site-name can-hide">小墨鱼的面试笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/interview/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/interview/pages/interview notes/JS 基础知识点.html" class="nav-link">
  面试笔记
</a></div><div class="nav-item"><a href="/interview/pages/interview questions/js基础面试题.html" class="nav-link">
  精选面试题
</a></div><div class="nav-item"><a href="https://github.com/cchroot/interview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/interview/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/interview/pages/interview notes/JS 基础知识点.html" class="nav-link">
  面试笔记
</a></div><div class="nav-item"><a href="/interview/pages/interview questions/js基础面试题.html" class="nav-link">
  精选面试题
</a></div><div class="nav-item"><a href="https://github.com/cchroot/interview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/JS 基础知识点.html" class="sidebar-link">基础知识点</a></li><li><a href="/interview/pages/interview notes/JS 进阶知识点.html" class="sidebar-link">JS 进阶知识点</a></li><li><a href="/interview/pages/interview notes/JS 异步编程.html" class="sidebar-link">异步编程</a></li><li><a href="/interview/pages/interview notes/浏览器与Node的事件循环Event Loop.html" class="sidebar-link">浏览器与Node的事件循环(Event Loop)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS手写相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/JS 手写相关.html" class="sidebar-link">JS 手写大全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/性能优化总结.html" class="active sidebar-link">性能优化总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#性能优化指标与测量工具" class="sidebar-link">性能优化指标与测量工具</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#传输加载优化" class="sidebar-link">传输加载优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#资源优化" class="sidebar-link">资源优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#渲染优化" class="sidebar-link">渲染优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#代码优化" class="sidebar-link">代码优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#构建优化" class="sidebar-link">构建优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#更多流行优化技术" class="sidebar-link">更多流行优化技术</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#数据库优化" class="sidebar-link">数据库优化</a></li><li class="sidebar-sub-header"><a href="/interview/pages/interview notes/性能优化总结.html#java-代码优化" class="sidebar-link">java 代码优化</a></li></ul></li><li><a href="/interview/pages/interview notes/网络协议相关优化.html" class="sidebar-link">网络协议相关优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/浏览器基础知识点.html" class="sidebar-link">浏览器基础知识点</a></li><li><a href="/interview/pages/interview notes/浏览器缓存机制.html" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/interview/pages/interview notes/浏览器渲染原理.html" class="sidebar-link">浏览器渲染原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/http.html" class="sidebar-link">HTTP知识整合</a></li><li><a href="/interview/pages/interview notes/从输入url到页面展示到底发生了什么.html" class="sidebar-link">从输入url到页面展示到底发生了什么</a></li><li><a href="/interview/pages/interview notes/从输入url开始能做哪些优化.html" class="sidebar-link">从输入url开始能做哪些优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/安全防范知识点.html" class="sidebar-link">安全防范知识点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>监控</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/前端监控.html" class="sidebar-link">前端监控</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue And React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/你能实现一个没有漏洞的双向绑定吗.html" class="sidebar-link">你能实现一个没有漏洞的双向绑定吗</a></li><li><a href="/interview/pages/interview notes/vue源码阅读笔记.html" class="sidebar-link">vue源码阅读笔记</a></li><li><a href="/interview/pages/interview notes/vueRouter源码阅读笔记.html" class="sidebar-link">vueRouter源码阅读笔记</a></li><li><a href="/interview/pages/interview notes/vuex源码阅读笔记.html" class="sidebar-link">vuex源码阅读笔记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/Webpack 性能优化.html" class="sidebar-link">Webpack 性能优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/nginx.html" class="sidebar-link">nginx 操作总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/一篇文章入门 redis（万字长文干货）.html" class="sidebar-link">一篇文章入门 redis（万字长文干货）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/pages/interview notes/一篇文章搞定 javascript 正则表达式.html" class="sidebar-link">一篇文章搞定 javascript 正则表达式</a></li><li><a href="/interview/pages/interview notes/interview.html" class="sidebar-link">很久很久以前的面试复习一</a></li><li><a href="/interview/pages/interview notes/interview2.html" class="sidebar-link">很久很久以前的面试复习二</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="优化总结"><a href="#优化总结" class="header-anchor">#</a> 优化总结</h1> <p>什么是前端性能优化？</p> <p>通常来说我们说的前端性能优化是指：从用户开始访问我们的网站到整个页面完整地展现出来的过程中，通过各种优化策略和优化方法，让页面加载的更快，让用户的操作响应更及时，给用户更好的使用体验。</p> <p>前端性能优化是我们每个前端打工人都必须面对的问题，那怎么进行性能优化呢？下面我就给大家分享我所了解的一些性能优化知识，有什么疑问请大家提出来，谢谢~</p> <h2 id="性能优化指标与测量工具"><a href="#性能优化指标与测量工具" class="header-anchor">#</a> 性能优化指标与测量工具</h2> <p>工欲善其事必先利其器，在进行性能优化之前，我们应该准备好自己的性能优化测量工具，并且要有优化目标，即某项或者多项指标需要优化到什么程度。</p> <h3 id="常用的性能优化指标"><a href="#常用的性能优化指标" class="header-anchor">#</a> 常用的性能优化指标</h3> <ul><li>Speed Index（lighthouse，速度指数）</li> <li>TTFB（Network，第一个请求响应时间）</li> <li>页面加载时间</li> <li>首次渲染</li> <li>交互动作的反馈时间</li> <li>帧率FPS（动画 ctrl+shift+p）</li> <li>异步请求完成时间</li></ul> <h3 id="性能测量工具"><a href="#性能测量工具" class="header-anchor">#</a> 性能测量工具</h3> <ul><li><p>Chrome DevTools</p> <ul><li>开发调试、性能评测</li> <li>Audit(Lighthouse)</li> <li>Throttling 调整网络吞吐</li> <li>Performance 性能分析</li> <li>Network 网络加载分析</li></ul></li> <li><p>Lighthouse</p> <ul><li>网站整体质量评估</li> <li>还可以提出优化建议</li></ul></li> <li><p>WebPageTest</p> <ul><li>测试多地点(球各地的用户访问你的网站的性能情况)</li> <li>全面性能报告（first view,repeat view,waterfall chart 等等）</li> <li>WebPageTest 还可以进行本地安装，让你的应用在还没上线的时候就可以测试。</li> <li>更多请看 <a href="https://webpagetest.org/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul> <h3 id="常用的性能测量api"><a href="#常用的性能测量api" class="header-anchor">#</a> 常用的性能测量API</h3> <p><strong>计算一些关键的性能指标</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Time to Interactive</span>
    <span class="token keyword">let</span> timing <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">// let timing = performance.timing</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>timing<span class="token punctuation">.</span>domInteractive<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>timing<span class="token punctuation">.</span>fetchStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> diff <span class="token operator">=</span> timing<span class="token punctuation">.</span>domInteractive <span class="token operator">-</span> timing<span class="token punctuation">.</span>fetchStart<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TTI: &quot;</span> <span class="token operator">+</span> diff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以上代码只测量了&quot;首次可交互时间&quot;，其它常用的性能指标还有：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DNS 解析耗时: domainLookupEnd - domainLookupStart
TCP 连接耗时: connectEnd - connectStart
SSL 安全连接耗时: connectEnd - secureConnectionStart
网络请求耗时 (TTFB): responseStart - requestStart
数据传输耗时: responseEnd - responseStart
DOM 解析耗时: domInteractive - responseEnd
资源加载耗时: loadEventStart - domContentLoadedEventEnd
First Byte时间: responseStart - domainLookupStart
白屏时间: responseEnd - fetchStart
首次可交互时间: domInteractive - fetchStart
DOM Ready 时间: domContentLoadEventEnd - fetchStart
页面完全加载时间: loadEventStart - fetchStart
http 头部大小： transferSize - encodedBodySize
重定向次数：performance.navigation.redirectCount
重定向耗时: redirectEnd - redirectStart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>观察长任务（long tasks）</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 通过 PerformanceObserver 得到所有的 long task 对象</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformanceObserver</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entry <span class="token keyword">of</span> list<span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 监听 long task</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>entryTypes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'longtask'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>监听页面可见性的状态</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> vEvent <span class="token operator">=</span> <span class="token string">'visibilitychange'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>webkitHidden <span class="token operator">!=</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// webkit prefix detected</span>
    vEvent <span class="token operator">=</span> <span class="token string">'webkitvisibilitychange'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">visibilityChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>hidden <span class="token operator">||</span> document<span class="token punctuation">.</span>webkitHidden<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Web page is hidden.&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Web page is visible.&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>vEvent<span class="token punctuation">,</span> visibilityChanged<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>通过监听页面可见性的状态可以判断用户是否在看当前页面，可以做一些处理，比如视频暂停，保存状态等等</p> <p><strong>判断用户网络状态</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> connection <span class="token operator">=</span> navigator<span class="token punctuation">.</span>connection <span class="token operator">||</span> navigator<span class="token punctuation">.</span>mozConnection <span class="token operator">||</span> navigator<span class="token punctuation">.</span>webkitConnection<span class="token punctuation">;</span>
<span class="token keyword">var</span> type <span class="token operator">=</span> connection<span class="token punctuation">.</span>effectiveType<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">updateConnectionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection type changed from &quot;</span> <span class="token operator">+</span> type <span class="token operator">+</span> <span class="token string">&quot; to &quot;</span> <span class="token operator">+</span> connection<span class="token punctuation">.</span>effectiveType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  type <span class="token operator">=</span> connection<span class="token punctuation">.</span>effectiveType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

connection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> updateConnectionStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>通过判断用户网络状态，可以做一些针对性的加载，比如用户网络状态好，就可以加载一些更加高清的图片，反之加载一些质量更差的图片等等。</p> <h2 id="传输加载优化"><a href="#传输加载优化" class="header-anchor">#</a> 传输加载优化</h2> <ul><li>减少 HTTP 请求</li> <li>启用 Gzip 压缩</li> <li>启用 Keep Alive 长连接（默认）</li> <li>HTTP 资源缓存</li> <li>Service workers
<ul><li>加速重复访问</li> <li>离线支持</li> <li>需要注意延长了首屏加载时间，但是页面总加载时间减少</li></ul></li> <li>启用 HTTP2</li> <li>考虑用SSR技术</li> <li>异步无阻塞加载JS（defer，async）</li></ul> <h2 id="资源优化"><a href="#资源优化" class="header-anchor">#</a> 资源优化</h2> <ul><li>资源压缩与合并</li> <li>图片格式优化，选择合适的图片格式</li> <li>图片加载优化（懒加载，渐进式加载，响应式图片，雪碧图）</li> <li>字体优化
<ul><li>字体未下载完成时，浏览器隐藏或自动降级，导致字体闪烁</li> <li>font-display</li> <li>@font-face 字符集拆分</li> <li>ajax + base64</li></ul></li></ul> <p><strong>图片格式选择</strong></p> <p>JPEG</p> <p>非常适合: 颜色丰富的照片，彩色图大焦点图、通栏 banner 图，结构不规则的图形</p> <p>不适合：线条图形和文字、图标图形，因为它的压缩算法不太适合这些类型的图形，并且不支持透明度</p> <p>压缩工具：jpegtran</p> <p>PNG</p> <p>非常适合: 纯色、透明、线条绘图、图标；边缘清晰、有大块相同颜色区域；颜色数较少单需要半透明</p> <p>不适合：由于是无损存储，彩色图像体积太大，所以不太适合颜色丰富，彩色大图</p> <p>压缩工具： node-pngquant-native</p> <p>GIF</p> <p>非常适合：动画，图标</p> <p>不适合：每个像素只有 8 比特，不适合存储彩色图片</p> <p>压缩工具：Gifsicle</p> <p>Webp</p> <p>非常适合：适用于图形和半透明图像</p> <p>不适合: 最多处理 256 色，不适合彩色图片</p> <p><strong>真的需要图片吗</strong>？</p> <p>Web font 代替图片</p> <p>使用 Data URI 代替图片</p> <p>采用 Image spriting（雪碧图）</p> <h2 id="渲染优化"><a href="#渲染优化" class="header-anchor">#</a> 渲染优化</h2> <ul><li>避免回流与重绘</li> <li>避免布局抖动（FastDom防止布局抖动利器）</li> <li>将动画和经常变化的元素提到单独的图层</li></ul> <h2 id="代码优化"><a href="#代码优化" class="header-anchor">#</a> 代码优化</h2> <h3 id="js-优化"><a href="#js-优化" class="header-anchor">#</a> JS 优化</h3> <ul><li>Code splitting 代码拆分，按需加载</li> <li>Tree shaking 代码减重</li> <li>Scope Hoisting 模块合并</li> <li>去除 console</li> <li>避免长任务</li> <li>避免超过 1kb 的行间脚本</li> <li>大量事件绑定使用事件委托</li> <li>适时使用防抖和节流</li> <li>避免内存泄漏</li> <li>使用 rAF 和 rIC 进行时间调度（react时间调度原理）</li> <li>配合 V8 有效优化代码
<ul><li>源码 -&gt; 抽象语法树 -&gt; 字节码Bytecode -&gt; 机器码</li> <li>编译过程会进行优化（脚本流、字节码缓存、懒解析等）</li> <li>运行时可能会发生反优化</li></ul></li> <li>对象优化可以做哪些
<ul><li>以相同顺序初始化对象成员，避免隐藏类的调整</li> <li>实例化后避免添加新属性</li> <li>尽量使用 Array 代替 array-like 对象</li> <li>避免读取超过数组的长度</li> <li>避免元素类型转换</li></ul></li></ul> <h3 id="html-优化"><a href="#html-优化" class="header-anchor">#</a> HTML 优化</h3> <ul><li>精简 HTML 代码</li> <li>减少 iframes 使用，延迟加载 iframe，父文档加载完毕后再给 iframe 的 src 赋值</li> <li>压缩空白符</li> <li>避免节点深层级嵌套</li> <li>避免 table 布局</li> <li>删除注释</li> <li>CSS&amp;Javascript尽量外链</li> <li>删除元素默认属性</li></ul> <h3 id="css-优化"><a href="#css-优化" class="header-anchor">#</a> CSS 优化</h3> <p><strong>提升 CSS 渲染性能</strong></p> <ul><li>谨慎使用 expensive 昂贵的属性
<ul><li>如 :nth-child 伪类; position: fixed 定位</li></ul></li> <li>尽量减少样式层级数量
<ul><li>如 div ul li span i {color: true;}</li></ul></li> <li>尽量避免使用占用过多 CPU 和内存的属性
<ul><li>如 text-indent: -9999px</li></ul></li> <li>尽量避免使用耗电量大的属性
<ul><li>如 CSS3：3D transforms、CSS3 transitions、Opacity</li></ul></li> <li>尽量避免使用 CSS 表达式
<ul><li>background-color: expression((new Date()).getHours() % 2 ? &quot;#FFF&quot; : &quot;#000&quot;)</li></ul></li> <li>尽量避免使用通配选择器,有选择地使用选择器
<ul><li>body &gt; a {font-weight: blod;}</li></ul></li> <li>尽量避免类正则的属性选择器
<ul><li>*=,|=,^=,$=</li></ul></li> <li>使用 contain 属性，告诉浏览器某些方面可以这样优化，哪些不能优化</li> <li>使用 font-display 属性，帮助我们把文字更早显示在页面上，还可以减少文字闪动问题</li></ul> <p><strong>提升 CSS 文件加载性能</strong></p> <ul><li>内联首屏关键CSS（Critical CSS）</li> <li>使用外链的 CSS</li> <li>尽量避免使用 @import</li> <li>异步加载CSS</li></ul> <p><strong>精简 CSS 代码</strong></p> <ul><li>使用后缩写语句</li> <li>删除不必要的零</li> <li>删除不必要的单位，如px</li> <li>删除过多的分号</li> <li>删除空格的注释</li> <li>尽量减少样式表的大小</li></ul> <p><strong>合理使用 Web Fonts</strong></p> <ul><li>将字体部署在 CDN 上</li> <li>将字体以 base64 形式保存在 CSS 中并通过 localStorage 进行缓存</li> <li>Google 字体库因为某些不可抗原因，应该使用国内托管服务</li></ul> <p><strong>CSS 动画优化</strong></p> <ul><li>尽量避免同时动画</li> <li>延迟动画初始化</li> <li>结合 SVG</li></ul> <h2 id="构建优化"><a href="#构建优化" class="header-anchor">#</a> 构建优化</h2> <p><strong>加快构建速度(打包速度)</strong></p> <p>使用 speed-measure-webpack-plugin 插件可以测量各个插件和loader所花费的时间，量化打包速度，判断优化效果</p> <ol><li>缩小文件的搜索范围(配置include/exclude resolve.modules resolve.mainFields alias noParse extensions)
<ol><li>通过 exclude、include 配置来确保转译尽可能少的文件</li> <li>优化 resolve.modules 配置</li> <li>优化 resolve.mainFields 配置</li> <li>alias</li> <li>noParse</li> <li>extensions</li></ol></li> <li>在一些性能开销较大的 loader 之前添加 cache-loader，将结果缓存中磁盘中</li> <li>使用 happypack 开启多进程打包</li> <li>除了使用 Happypack 外，我们也可以使用 thread-loader 开启多进程打包 loader</li> <li>使用 HardSourceWebpackPlugin 为模块提供中间缓存，第二次构建可大量节约时间</li> <li>使用 IgnorePlugin 忽略第三方包指定目录，例如 moment 的本地语言包</li> <li>使用 webpack-parallel-uglify-plugin 开启 JS 多进程压缩</li></ol> <p><strong>减少打包文件体积</strong></p> <p>引入 webpack-bundle-analyzer 分析打包后的文件，判断哪些包还可以拆分和优化</p> <ol><li>使用 externals 配置，然后将 JS 文件、CSS 文件和存储在 CDN</li> <li>使用 DllPlugin（动态链接库）将 bundles 拆分，使用 DllReferencePlugin(索引链接) 对 manifest.json 引用，让一些基本不会改动的代码先打包成静态资源，避免反复编译浪费时间</li> <li>使用 optimization.splitChunks 配置抽离公共代码</li> <li>使用 IgnorePlugin 忽略第三方包指定目录，例如 moment 的本地语言包（重复）</li> <li>使用 url-loader 或 image-webpack-loader 对图片进行转化或者压缩处理</li> <li>优化 SourceMap，开发环境推荐： cheap-module-eval-source-map，生产环境推荐： cheap-module-source-map</li> <li>按需加载，项目中的路由懒加载</li> <li>webpack自身的优化：
<ol><li>tree-shaking，在生产环境下，会自动移除没有使用到的代码</li> <li>scope hosting 作用域提升，变量提升，可以减少一些变量声明</li> <li>babel 配置的优化，配置 @babel/plugin-transform-runtime，重复使用 Babel 注入的帮助程序，以节省代码大小的插件</li></ol></li></ol> <h2 id="更多流行优化技术"><a href="#更多流行优化技术" class="header-anchor">#</a> 更多流行优化技术</h2> <ul><li>移动端使用 SVG 图标</li> <li>使用 Flexbox 优化布局</li> <li>优化资源加载顺序，给资源设置优先级
<ul><li>Preload：提前加载较晚出现，但对当前页面非常重要的资源</li> <li>Prefetch：提前加载后继路由需要的资源，优先级低</li> <li>dns-prefetch：对链接进行 DNS 预解析</li> <li>prerender:标识下一个导航可能需要的资源</li></ul></li> <li>预渲染页面（react-snap，vue也可以使用）</li> <li>Windowing、虚拟列表等提高列表性能</li> <li>使用骨架组件减少布局移动和页面抖动</li></ul> <p>不同的应用场景可能会采用不同的优化方案和优化技术，对于一个应用，不能所有的优化都一股脑想用上去，因为优化也会带来一定的成本，比如配置麻烦，需要遵守一些特定的规则等等。</p> <h2 id="数据库优化"><a href="#数据库优化" class="header-anchor">#</a> 数据库优化</h2> <ol><li>查询语句无论是使用哪种判断条件：等于、小于、大于，WHERE 左侧的条件查询字段不要使用函数或者表达式</li> <li>使用 EXPLAIN 命令优化你的 SELECT 查询，对于复杂、效率低的 SQL 语句，我们通常是使用 explain sql 来分析这条 SQL 语句，这样方便我们分析，进行优化</li> <li>当你的 SELECT 查询语句只需要使用一条记录时，要使用 LIMIT 1</li> <li>不要直接使用 SELECT *,而应该使用需要查询的表字段，因为使用 EXPLAIN 进行分析时，SELECT * 使用的是全表扫描，也就是 type = all</li> <li>为没一张表设置一个 ID 属性</li> <li>避免再 WHERE 字句中对字段进行 NULL 判断</li> <li>避免再 WHERE 中使用 != 或 <code>&lt;&gt;</code> 操作符</li> <li>使用 BETWEEN AND 替代 IN</li> <li>为搜索字段创建索引</li> <li>选择正确的存储引擎，innoDB、MyISAM、MEMORY 等</li> <li>使用 <code>LINK %abc%</code> 不会走索引，而使用 <code>LINK abc%</code> 会走索引</li> <li>对于美剧类型的字段（即有固定罗列值得字段），建议使用 EMUM 而不是 VARCHAR，如性别、星期、类型、类别等</li> <li>拆分打得 DELETE 或 INSERT 语句</li> <li>选择合适得字段类型，选择标准是：尽可能小、尽可能定长、尽可能使用整数</li> <li>字段设计尽可能使用 NOT NULL</li> <li>进行水平切割或者垂直分割</li></ol> <p>水平分割：通过建立结构相同得几张表分别存储数据
垂直分割：将经常一起使用得字段放在一个单独的表中，分割后的表记录之间是一一对应的关系</p> <h2 id="java-代码优化"><a href="#java-代码优化" class="header-anchor">#</a> java 代码优化</h2> <ol><li>尽量指定类、方法的 final 修饰符</li> <li>尽量重用对象</li> <li>尽可能使用局部变量</li> <li>及时关闭流</li> <li>尽量减少对变量的重复计算</li> <li>尽量采用懒加载的策略，即在需要的时候才创建</li> <li>慎用异常</li> <li>不要在循环中使用 <code>try...catch...</code>，应该把其放在最外层</li> <li>如果能估计到待添加的内容长度，为底层以数组方式实现的集合、工具类指定初始长度</li> <li>当复制大量数据时，使用<code>System.arraycopy()</code>命令</li> <li>乘法和除法使用移位操作</li> <li>循环内不要不断创建对象引用</li> <li>基于效率和类型检查的考虑，应该尽可能使用array，无法确定数组大小时才使用 ArrayList</li> <li>尽量使用 HashMap、ArrayList、StringBuilder，除非线程安全需要，否则不推荐使用 Hashtable、Vector、StringBuffer，后三者由于使用同步机制而导致了性能开销</li> <li>不要将数组声明为 public static final</li> <li>尽量在合适的场合使用单例</li> <li>尽量避免随意使用静态变量</li> <li>及时清除不再需要的会话</li> <li>避免内存泄漏</li> <li>字符串变量和字符串常量 equals 的时候将字符串常量写在前面，避免空指针异常</li></ol> <p>更多请看:<a href="https://www.cnblogs.com/xiang--liu/p/11599882.html" target="_blank" rel="noopener noreferrer">java 代码优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interview/pages/interview notes/JS 手写相关.html" class="prev">
        JS 手写大全
      </a></span> <span class="next"><a href="/interview/pages/interview notes/网络协议相关优化.html">
        网络协议相关优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/interview/assets/js/app.315fcd90.js" defer></script><script src="/interview/assets/js/3.2951d97b.js" defer></script><script src="/interview/assets/js/40.20696ba5.js" defer></script>
  </body>
</html>
